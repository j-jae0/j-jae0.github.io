---
title:  "[비즈니스 분석] Python으로 US E-commerce 데이터 분석하기 - RFM"
layout: single

categories: "Project"
tags: ["Python", "RFM"]

toc: true
toc_sticky: true
toc_label : "목차"
toc_icon: "bars"
published: false
---

<small>목표: Kaggle의 'United States E-Commerce records 2020' 데이터셋으로 RFM 분석한다.</small>

***

# 프로젝트 목적
- '2020년 미국의 E-커머스 판매 데이터'를 사용하여 자사 서비스의 매출을 증가시킬 수 있는 방법을 고안해 본다.
- 유저의 구매 데이터를 기반으로 RFM 분석을 하고, 이를 바탕으로 인사이트와 액션을 제안해 본다.

## 🔍 RFM 분석이란?
CRM(Customer Relationship Management) 기법 중 하나로 아래 세 가지 유형을 기준으로 사용자 그룹을 나누어 분류하는 분석 기법이다.
```
Recency : 얼마나 최근에 구매했는가
Frequecy : 얼마나 자주 구매했는가
Monetary : 얼마나 많은 금액을 지출했는가
```

<br>

# 1. 데이터, 라이브러리 로드
분석에 필요한 라이브러리를 로드한다.
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# 그래프 그릴 때, 한글지원
import koreanize_matplotlib
%config InlineBackend.figure_format = 'retina'
```

Kaggle에서 다운받은 파일을 로드한다.
```python
df = pd.read_csv('US_E_commerce_records_2020.csv', encoding='windows-1252')
```

📝 **windows-1252**<br>
해당 파일을 로드하면 utf-8 방식으로 디코딩할 수 없고 위치가 8587의 바이트가 0xa0라는 에러 메세지가 발생한다. 확장된 ASCII 에 널리 사용되는 windons-1252를 사용하면 데이터를 불러올 수 있다. 자세한 해결 과정은 [EDA 과정을 담은 게시물](https://j-jae0.github.io/project/business-01/)을 참고하면 된다.
{: .notice}

<br>

# 2. 고객에 대한 데이터셋 정의
df(raw data)는 한 장바구니에 대한 데이터라도 물품별 주문건수를 행으로 기입된 것이다. 고객별로 주문건수가 어떻게 되는지, 총 지출정도가 어떻게 되는지 등을 새로운 데이터프레임으로 정의한다. 

```python
# 고객별 총 판매액, 순이익, 첫구매일, 최근구매일, 구매횟수를 customer_df에 저장한다.
customer_df = df.groupby(by='Customer ID').agg({'Sales': 'sum', 
                                                'Profit': 'sum', 
                                                'Order Date': ['min', 'max'], 
                                                'Order ID': 'nunique'})
# 인덱스에 위치한 사용자 id를 컬럼으로 내보낸다.
customer_df.reset_index(inplace=True)

# 컬럼명을 다시 정의한다.
columns = ['customer_id', 'total_sales', 'total_profit','first_order_date', 'last_order_date', 'cnt_orders']
customer_df.columns = columns
```

![img1](/assets/images/US_E_Commerce/customer_df_head.png){: .align-center width="60%"}
<center><small>customer_df.head()의 출력 결과물</small></center>

<br>

# 3. RFM 기준 선정
RFM 분석을 진행하기 전, 세 유형의 기준을 정해야한다. 기준은 아래와 같은 이유로 선정하였다.

## 3-1. Recency
```python
# 월을 기준으로 그룹화하고 월별 주문건수, 구매자 수를 구한다.
g_df = df.groupby('order_month').agg({"Customer ID": "nunique", "Order ID": "nunique"})

# 주문건수는 bar, 구매자 수는 line으로 그래프를 그린다.
fig, ax = plt.subplots(figsize=(8, 4))
colors = sns.color_palette('Blues', 12)

plt.bar(g_df.index, g_df['Order ID'], color=colors, label='주문수')
plt.plot(g_df.index, g_df['Customer ID'], color='k',
         linestyle='--', marker='o', label='고객수')
plt.legend(ncols=1)
plt.show()
```

![img2](/assets/images/US_E_Commerce/bar_line_graph.png){: .align-center width="80%"}
<center><small>월별(x축) 주문건수(bar) 및 고객수(line)</small></center>

<br>

위 그래프를 보면 알 수 있듯이, 한 고객이 해당 월에 두 번 이상 구매하는 경우는 잘 없다(월별로 구매한 고객의 nunique값과 주문건수의 값이 거의 일치). <u>그래프를 보니, 사무실에서 필요한 물품을 구매하는데 한달에 한 번 이상 구매한다면 자사에 어느정도 충성도가 있지않을까라는 생각이 들었다. 이러한 이유로 R를 '최근 한달 내에 구매했는가?'를 기준으로 설정했다.</u> 2020년도 판매 내역의 데이터이므로 최근 한달의 기준은 2021년 01월 01일을 기준으로 설정한다.

📝 **Recency 기준**
<br>2021년 1월 1일 기준, 최근 한달 내에 구매 이력이 있는가?
{: .notice}

## 3-2. Frequecy
```python
# 고객별 주문횟수의 분포를 확인하기 위해 boxplot 그린다.
fig, ax = plt.subplots(figsize=(5, 3))
sns.boxplot(data=customer_df, x='cnt_orders', color='lightblue')
```

![img3](/assets/images/US_E_Commerce/boxplot.png){: .align-center width="50%"}

```python
# 고객별의 90%가 4번이하의 주문 경험이 있다. 
customer_df['cnt_orders'].quantile(.90)
>>> 4.0
```

F는 '5번 이상의 구매경험이 있는가?'를 기준으로 설정하였다. 고객별 주문횟수의 boxplot 그래프와 고객의 90%가 4번 이하의 주문경험이 있다는 점에서 착안하였다. 상위 10% 이내의 고객의 구매경험을 기준으로 하면 자사에 대한 애정 정도를 분류하는데 도움이 될 것이라고 판단하였다. 

📝 **Frequecy 기준**
<br>5번 이상의 구매경험이 있는가?
{: .notice}

## 3-3. Monetary
```python
# 고객별 판매액의 분포를 확인하기 위해 boxplot 그린다.
sns.boxplot(x=customer_df['total_sales'], color='lightblue')
```

![img4](/assets/images/US_E_Commerce/boxplot2.png){: .align-center width="50%"}

```python
# 고객별의 90%가 약 2384 달러 이하의 지출경험이 있다. 
customer_df['total_sales'].quantile(0.90)
>>> 2384.610400000001
```

M는 '2500 달러 이상의 지출경험이 있는가?'를 기준으로 설정하였다. 고객별 총 지출금액의 boxplot 그래프와 고객의 90%가 약 2384 달러 이하의 지출경험이 있다는 점에서 착안하였다. 상위 10% 이내의 고객의 구매경험을 기준으로 하면 자사에 대한 애정 정도를 분류하는데 도움이 될 것이라고 판단하였다. 

📝 **Monetary 기준**
<br>2500 달러 이상의 지출경험이 있는가?
{: .notice}

<br>

# 4. 


<br>

# Reference
- [Kaggle, 'United States E-Commerce records 2020' 데이터셋 출처](https://www.kaggle.com/datasets/ammaraahmad/us-ecommerce-record-2020)

<br>

👩🏻‍💻개인 공부 기록용 블로그입니다
<br>오류나 틀린 부분이 있을 경우 댓글 혹은 메일로 따끔하게 지적해주시면 감사하겠습니다.
{: .notice}