---
title: "[Forecasting] 2022년 판매량 예측하기 - EDA"
excerpt: "캐글 데이터셋, Forecasting Mini-Course(S3E19) EDA 진행"
layout: single
categories: "Python"
tags: ["EDA"]

toc: true
toc_sticky: true
toc_label : "목차"
toc_icon: "bars"
published: false
---

🌈 **Kaggle Playground**
<br>데이터는 [Kaggle datasets, 'Forecasting Mini-Course Sales'](https://www.kaggle.com/competitions/playground-series-s3e19)에서 다운 받아서 사용하였다. 
데이터는 날짜, 국가, 매장, 제품, 판매량을 포함햔다. 본 프로젝트의 목표는 주어진 데이터를 활용하여 2022년의 판매량을 예측하는 것이다.
{: .notice}


# 1. 라이브러리 로드
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

import koreanize_matplotlib
%config InlineBackend.figure_format = 'retina'
```

# 2. 데이터 로드
```python
df = pd.read_csv('/kaggle/input/playground-series-s3e19/train.csv')
```

# 3. EDA
## (1) 기술통계
```python
# 데이터 요약용 함수
def summary(df):
    print(f'data shape: {df.shape}')
    describes = df.describe(include='all', datetime_is_numeric=True).T
    # summary용 dataframe 생성
    summary_df = pd.DataFrame(df.dtypes, columns=['data type'])
    summary_df['#unique'] = df.nunique().values
    summary_df['#missing'] = df.isnull().sum().values
    summary_df['%missing'] = df.isnull().mean().values * 100
    if 'min' in describes.columns:
        summary_df['min'] = describes['min'].values
        summary_df['max'] = describes['max'].values
        summary_df['mean'] = describes['mean'].values
        summary_df['std'] = describes['std'].values
    if 'top' in describes.columns:
        summary_df['top'] = describes['top'].values
        summary_df['freq'] = describes['freq'].values
    summary_df['1st value'] = df.loc[0].values
    summary_df['2nd value'] = df.loc[1].values
    summary_df['3rd value'] = df.loc[2].values
    return summary_df

summary(df)
```

<div style="text-align : center;">
<img src="/assets/images/project/s3e19/s3e19_1.png">
</div>

<br>

### 1-1. 수치형 데이터
- id 은 유일값으로 이루어졌다(0 ~ 136949 사이의 값을 가짐).
- num_sold 를 보면 날짜, 나라, 매장, 상품별 판매량을 나타내는데 최솟값 2, 최댓값 1380, 평균 165.522636(≈ 166), 표준편차 183.691575(≈ 184)의 기술통계량을 가진다.

### 1-2. 범주형 데이터
- date 는 '연도-월-일' 로 날짜를 표현하며 '2017-01-01'이 시작값이다.
  - object 타입을 datetime으로 변환하는 과정이 필요
  - 날짜별 판매추이를 확인해볼 필요가 있음
- country, store, product 는 categorical 데이터이다.
  - top을 보면 나라 'Argentina', 매장 'Kaggle Learn', 상품 'Using LLMs to Improve Your Coding'이 가장 많이 등장했음을 알 수 있다.
    - 만약 등장한 횟수가 모두 동일하면 첫 번째 요소가 대표로 출력된다(확인해볼 필요가 있음).


## (2) datetime 형태 변환
```python
# object 타입의 date를 datetime 로 변환한다.
df['date'] = pd.to_datetime(df['date'])

print(f"start date: {df['date'].min()}")
print(f"end date: {df['date'].max()}")
```
```
start date: 2017-01-01 00:00:00
end date: 2021-12-31 00:00:00
```

'train.csv'는 2017-01-01 ~ 2021-12-31 의 판매 데이터(5년치)를 포함한다.

## (3) 날짜별 판매추이
### 3-1. 일별 총 판매량
```python
daily_sales = df.groupby(by='date')['num_sold'].agg('sum')
daily_sales.plot(title='일별 총 판매량(2017-2021)', ylabel='sum of sales', figsize=(12, 4));
```

<div style="text-align : center;">
<img src="/assets/images/project/s3e19/s3e19_2.png" width="90%">
</div>

<br>

그래프를 보면, x값이 2018, 2019, 2020, 2021 부근에서 판매량이 급격히 증가하는 것으로 보인다(계절성이 있는 것으로 판단됨). 2020년 1분기쯤에서 판매량이 급격히 감소하는데 이는 외부요인으로 인한 현상으로 생각된다(2020년에는 코로나 등 사회적 이슈가 판매에 직접적인 영향을 줌). 소비의 행태가 이커머스 시장으로 확장되었기 때문이다.

### 3-2. 월별 총 판매량
```python
monthly_sales = df.resample(rule='M', on='date').sum()['num_sold']
monthly_sales.plot(title='월별 총 판매량(2017-2021)', ylabel='sum of sales', figsize=(12, 4));
```

<div style="text-align : center;">
<img src="/assets/images/project/s3e19/s3e19_3.png" width="90%">
</div>

<br>

resample 함수를 사용하면 날짜 데이터를 특정 규칙(특정 주기)을 기준으로 구간별 집계가 가능하다. rule에 'M'을 전달하면 날짜가 해당 월의 마지막 날짜로 변환되고 월별 마지막 일자를 기준으로 총 판매량을 집계하였다. 월별 총 판매량 그래프를 보면 판매되는 제품의 수가 전반적으로 증가하는 것으로 보인다.

### 3-3. 연도, 월별 판매량
```python
monthly_year_sales = monthly_sales.reset_index()
monthly_year_sales['year'] = monthly_year_sales['date'].dt.year
monthly_year_sales['month'] = monthly_year_sales['date'].dt.month

figure(figsize=(12, 6))
sns.lineplot(data=monthly_year_sales, x='month', y='num_sold', hue='year').set(title='연도, 월별 판매량', xlabel='Month', ylabel='Sum of sales');
```

<div style="text-align : center;">
<img src="/assets/images/project/s3e19/s3e19_4.png" width="90%">
</div>

<br>

각 연도별로 월별 판매량을 그래프로 그려보았을 때, 총 판매량이 비슷한 추세를 가지고 있음을 알 수 있다. 한 해에서 1, 11, 12월에 가장 많은 상품이 판매된다.

## (4) 나라별 판매추이

## (5) 매장별 판매추이

## (6) 상품별 판매추이