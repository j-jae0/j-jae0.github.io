---
title:  "[ë¹„ì¦ˆë‹ˆìŠ¤ ë¶„ì„] Pythonìœ¼ë¡œ US E-commerce ë°ì´í„° ë¶„ì„í•˜ê¸° - EDA"
layout: single

categories: "Project"
tags: ["Python", "EDA", "ErrorğŸš¨"]

toc: true
toc_sticky: true
toc_label : "ëª©ì°¨"
toc_icon: "bars"
---

<small>ëª©í‘œ: Kaggleì˜ 'United States E-Commerce records 2020' ë°ì´í„°ì…‹ìœ¼ë¡œ RFM ë¶„ì„í•˜ê¸° ì „, EDAë¥¼ ì§„í–‰í•œë‹¤.</small>

***

# í”„ë¡œì íŠ¸ ëª©ì 
- '2020ë…„ ë¯¸êµ­ì˜ E-ì»¤ë¨¸ìŠ¤ íŒë§¤ ë°ì´í„°'ë¥¼ ì‚¬ìš©í•˜ì—¬ ìì‚¬ ì„œë¹„ìŠ¤ì˜ ë§¤ì¶œì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³ ì•ˆí•´ ë³¸ë‹¤.
- ìœ ì €ì˜ êµ¬ë§¤ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ RFM ë¶„ì„ì„ í•˜ê³ , ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¸ì‚¬ì´íŠ¸ì™€ ì•¡ì…˜ì„ ì œì•ˆí•´ ë³¸ë‹¤.

<br>

# 1. ë°ì´í„°, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
ë¶„ì„ì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•œë‹¤.
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# ê·¸ë˜í”„ ê·¸ë¦´ ë•Œ, í•œê¸€ì§€ì›
import koreanize_matplotlib
%config InlineBackend.figure_format = 'retina'
```

Kaggleì—ì„œ ë‹¤ìš´ë°›ì€ íŒŒì¼ì„ ë¡œë“œí•œë‹¤.
```python
df = pd.read_csv('US_E_commerce_records_2020.csv', encoding='windows-1252')
```

## 1-1. ì¸ì½”ë”© ì´ìŠˆ
ë‹¤ìš´ë°›ì€ ë°ì´í„°ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë¶ˆëŸ¬ì˜¤ë©´ ë‹¤ìŒ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤.

```python
df = pd.read_csv('US_E_commerce_records_2020.csv')
```

<span style="color: red">UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa0 in position 8587: invalid start byte</span>

ğŸš¨ **ì—ëŸ¬ í•´ì„**<br>
utf-8 ë°©ì‹ìœ¼ë¡œ ë””ì½”ë”©í•  ìˆ˜ ì—†ê³  ìœ„ì¹˜ê°€ 8587ì˜ ë°”ì´íŠ¸ê°€ 0xa0ë¼ëŠ” ì˜ë¯¸ì´ë‹¤. ì´ë•Œ 0xa0ëŠ” hexadecimal(16ì§„ìˆ˜)ë¡œ í‘œí˜„ëœ 'ì¤„ë°”ê¿ˆ í•˜ì§€ ì•ŠëŠ” ê³µë°±(non-breaking space, NBSP)'ì´ë‹¤. íŠ¹ì • ìœ„ì¹˜ì— ê³µë°±ì˜ ê¸°í˜¸ê°€ 0xa0ë¡œ ë“¤ì–´ê°€ìˆì–´ì„œ utf-8 ë°©ì‹ìœ¼ë¡œ ë””ì½”ë“œí•  ìˆ˜ ì—†ë‹¤ëŠ” ëœ»ì´ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í™•ì¥ëœ ASCII ì— ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” windons-1252ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
{: .notice--danger}

<br>

# 2. ë°ì´í„° í™•ì¸
ë°ì´í„°ê°€ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë°ì´í„° í”„ë ˆì„ì—ì„œ ê°€ì¥ ì•ì— ìˆëŠ” 5ê°œì˜ í–‰ì„ ì¶œë ¥í•œë‹¤.
```python
df.head()
```
![head](/assets/images/US_E_Commerce/df_head.png){: .align-center}

ë°ì´í„°ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ ì£¼ë¬¸ ì¼ìê°€ ë¬¸ìì—´ í˜•íƒœë¡œ 'ì¼-ì›”-ì—°ë„'ë¡œ ì €ì¥ë˜ì–´ìˆë‹¤. ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬ë¡œ ê°ì‹¸ì§„ ë¶€ë¶„ì„ ë³´ë©´ ì£¼ë¬¸ì¼ì, ì£¼ë¬¸ë²ˆí˜¸, ê³ ê°idê°€ ê°™ì€ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì¦‰ í•œ ê³ ê°ì´ ê°™ì€ ë‚  ì—¬ëŸ¬ ë¬¼ê±´ì„ ì£¼ë¬¸í•˜ë©´ ì£¼ë¬¸í•œ ë¬¼ê±´ë§ˆë‹¤ í–‰ìœ¼ë¡œ ì €ì¥ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì¥ë°”êµ¬ë‹ˆì— ë“¤ì–´ê°„ ê³ ê¸°ì™€ ì–‘íŒŒë¥¼ ì£¼ë¬¸í•œë‹¤ë©´ ê³ ê¸°ì— ëŒ€í•œ ì£¼ë¬¸ ë°ì´í„°, ì–‘íŒŒì— ëŒ€í•œ ì£¼ë¬¸ ë°ì´í„°ê°€ ë”°ë¡œ ë“¤ì–´ê°„ë‹¤.

```python
# ë°ì´í„°ê°€ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ê° ì—´ë“¤ì˜ ìë£Œí˜•ì„ í™•ì¸í•œë‹¤.
df.info()
```

![head](/assets/images/US_E_Commerce/df_info.png){: .align-center width="45%"}

ì´ 19ê°œì˜ ì—´, 3312ê°œì˜ í–‰ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ìˆìœ¼ë©° ëª¨ë“  ì—´ì— ëŒ€í•´ ê²°ì¸¡ì¹˜ëŠ” ì—†ë‹¤.

## 2-1. Attribute Information
- **Order Date** : ì£¼ë¬¸ ì¼ì
- **Row ID** : í–‰ì— ëŒ€í•œ id
- **Order ID** : ì£¼ë¬¸ê±´ì— ëŒ€í•œ id
- **Ship Mode** : ë°°ì†¡ ë“±ê¸‰(Standard Class/Second Class/First Class/Same Day)
- **Customer ID** : ê³ ê°ì˜ ê³ ìœ  id
- **Segment** : ê³ ê°ì˜ íƒ€ì…(Consumer/Corporate/Home Office)
- **Country** : ê³ ê°ì˜ êµ­ê°€
- **City** : ê³ ê°ì˜ ë„ì‹œ
- **State** : ê³ ê°ì˜ ì£¼
- **Postal Code** : ê³ ê°ì˜ ìš°í¸ë³€í˜¸
- **Region** : ê³ ê°ì´ ìœ„ì¹˜í•œ ì§€ì—­
- **Product ID** : ì œí’ˆì˜ ì•„ì´ë””
  - category(3)-subcategory(2)-ê³ ìœ ì•„ì´ë”” ìˆœìœ¼ë¡œ ì œí’ˆì˜ ì•„ì´ë””ê°€ ê²°ì •ë¨
- **Category** : ì œí’ˆì˜ 1ì°¨ ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬(Office Supplies/Furniture/Technology)
- **Sub-Category** : ì œí’ˆì˜ 1ì°¨ ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ë¥¼ ê¸°ë°˜í•œ ìƒì„¸ ì¹´í…Œê³ ë¦¬
- **Product Name** : ì œí’ˆì˜ ì´ë¦„
- **Sales** : íŒë§¤ê°€
- **Quatity** : êµ¬ë§¤ ìˆ˜ëŸ‰
- **Discount** : í• ì¸ìœ¨
- **Proit** : ë§¤ì¶œì— ëŒ€ë¹„í•œ ìˆœ ì´ìµ

<br>

# 3. ê¸°ìˆ  í†µê³„
```python
# ìˆ˜ì¹˜ íƒ€ì…ì˜ ê¸°ìˆ í†µê³„ë¥¼ êµ¬í•œë‹¤.
df.describe()
```

![describe](/assets/images/US_E_Commerce/describe.png){: .align-center width="65%"}

```python
# ë¬¸ìì—´ íƒ€ì…ì˜ ê¸°ìˆ í†µê³„ë¥¼ êµ¬í•œë‹¤.
df.describe(include="O")
```

![describe_object](/assets/images/US_E_Commerce/describe_object.png){: .align-center}

- ìˆœì´ìµ(Profit)ì€ -ê°’ ë˜ëŠ” +ê°’ì´ ë  ìˆ˜ ìˆë‹¤. 
- ì£¼ë¬¸ idì˜ nunique ê°’(1687)ì€ ì‚¬ìš©ìê°€ 1ê°œ ì´ìƒì˜ ë¬¼í’ˆì´ ë‹´ê¸´ ì¥ë°”êµ¬ë‹ˆë¥¼ êµ¬ë§¤íšŸìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤. 
- Countryê°€ United States ë¿ì´ë¼ëŠ” ì ì—ì„œ í•´ì™¸ ë°°ì†¡ì´ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ” ì‚¬ì´íŠ¸ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.
- 3312ê±´ì— ëŒ€í•œ ë°ì´í„°ëŠ” 694ëª…ì˜ íšŒì›ì— ì˜í•´ íŒë§¤ëœ ê²ƒì´ë‹¤. 
- íŒë§¤ë˜ê³  ìˆëŠ” ì£¼ìš” ë¬¼í’ˆì€ ì‚¬ë¬´ìš©í’ˆìœ¼ë¡œ íŒë§¤ì˜ ì•½ 60%ë¥¼ ì°¨ì§€í•œë‹¤. ê·¸ ì¤‘ ë°”ì¸ë”ê°€ ì£¼ íŒë§¤ ë¬¼í’ˆì¸ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

<br>

# 4. íˆìŠ¤í† ê·¸ë¨
```python
# ì „ì²´ ìˆ˜ì¹˜ë³€ìˆ˜ ì‹œê°í™”
df.hist(bins=20, figsize=(8, 8))
```
![hist](/assets/images/US_E_Commerce/hist.png){: .align-center width="60%"}

- ì£¼ë¬¸ìˆ˜ëŸ‰(Quantity)ë¥¼ ë³´ë©´ í•œ ì¢…ë¥˜ì˜ ë¬¼í’ˆì— ëŒ€í•´ 12ê°œ ì´ìƒì„ ì£¼ë¬¸í•œ ì¼€ì´ìŠ¤ë„ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
- í• ì¸ìœ¨(Discount)ê°€ 0ì¸ ê²½ìš°ê°€ ê°€ì¥ ë§ì§€ë§Œ 0.8 ì •ë„ì˜ í• ì¸ìœ¨ë¡œ êµ¬ë§¤í•œ ì´ë ¥ë„ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
- ìˆœ ì´ìµ(Profit)ì€ 0 ë¶€ê·¼ì— ë°€ì§‘ë˜ì–´ìˆìœ¼ë‚˜ -ì¸ ê²½ìš°ë„ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

<br>

# 5. ë‚ ì§œì— ëŒ€í•œ íŒŒìƒë³€ìˆ˜ ìƒì„±
```python
# ì£¼ë¬¸ì¼ìê°€ ë¬¸ìì—´ íƒ€ì…ìœ¼ë¡œ ì €ì¥ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ìë£Œí˜•ì„ ë‚ ì§œíƒ€ì…ìœ¼ë¡œ ë³€ê²½
df['Order Date'] = pd.to_datetime(df['Order Date'])
```

![datetime_info](/assets/images/US_E_Commerce/datetime_info.png){: .align-center width="45%"}
<center><small>ì£¼ë¬¸ì¼ìì˜ ìë£Œí˜•ì´ datetimeìœ¼ë¡œ ë°”ë€ ê²ƒì„ í™•ì¸, df.info()ì˜ ì¶œë ¥ ê²°ê³¼ë¬¼</small></center>

<br>

```python
# ì—°ë„, ì›”, ì¼, ìš”ì¼ íŒŒìƒë³€ìˆ˜ ìƒì„±
df["order_year"] = df["Order Date"].dt.year
df["order_month"] = df["Order Date"].dt.month
df["order_day"] = df["Order Date"].dt.day
df["order_dow"] = df["Order Date"].dt.dayofweek
```

<br>

# 6. ê³ ê°ì— ëŒ€í•œ ë°ì´í„°ì…‹ ì •ì˜
df(raw data)ëŠ” í•œ ì¥ë°”êµ¬ë‹ˆì— ëŒ€í•œ ë°ì´í„°ë¼ë„ ë¬¼í’ˆë³„ ì£¼ë¬¸ê±´ìˆ˜ë¥¼ í–‰ìœ¼ë¡œ ê¸°ì…ëœ ê²ƒì´ë‹¤. ê³ ê°ë³„ë¡œ ì£¼ë¬¸ê±´ìˆ˜ê°€ ì–´ë–»ê²Œ ë˜ëŠ”ì§€, ì´ ì§€ì¶œì •ë„ê°€ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ë“±ì„ ìƒˆë¡œìš´ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ì •ì˜í•œë‹¤. 

```python
# ê³ ê°ë³„ ì´ íŒë§¤ì•¡, ìˆœì´ìµ, ì²«êµ¬ë§¤ì¼, ìµœê·¼êµ¬ë§¤ì¼, êµ¬ë§¤íšŸìˆ˜ë¥¼ customer_dfì— ì €ì¥í•œë‹¤.
customer_df = df.groupby(by='Customer ID').agg({'Sales': 'sum', 
                                                'Profit': 'sum', 
                                                'Order Date': ['min', 'max'], 
                                                'Order ID': 'nunique'})
# ì¸ë±ìŠ¤ì— ìœ„ì¹˜í•œ ì‚¬ìš©ì idë¥¼ ì»¬ëŸ¼ìœ¼ë¡œ ë‚´ë³´ë‚¸ë‹¤.
customer_df.reset_index(inplace=True)

# ì»¬ëŸ¼ëª…ì„ ë‹¤ì‹œ ì •ì˜í•œë‹¤.
columns = ['customer_id', 'total_sales', 'total_profit','first_order_date', 'last_order_date', 'cnt_orders']
customer_df.columns = columns
```

![datetime_info](/assets/images/US_E_Commerce/customer_df_head.png){: .align-center width="60%"}
<center><small>customer_df.head()ì˜ ì¶œë ¥ ê²°ê³¼ë¬¼</small></center>

<br>

# 7. ì£¼ë¬¸ê±´ìˆ˜ì™€ êµ¬ë§¤ì ìˆ˜
## 7-1. ì›”ë³„ ì£¼ë¬¸ê±´ìˆ˜ì™€ êµ¬ë§¤ì ìˆ˜
```python
# ì›”ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”í•˜ê³  ì›”ë³„ ì£¼ë¬¸ê±´ìˆ˜, êµ¬ë§¤ì ìˆ˜ë¥¼ êµ¬í•œë‹¤.
g_df = df.groupby('order_month').agg({"Customer ID": "nunique", "Order ID": "nunique"})

# ì£¼ë¬¸ê±´ìˆ˜ëŠ” bar, êµ¬ë§¤ì ìˆ˜ëŠ” lineìœ¼ë¡œ ê·¸ë˜í”„ë¥¼ ê·¸ë¦°ë‹¤.
fig, ax = plt.subplots(figsize=(8, 4))
colors = sns.color_palette('Blues', 12)

plt.bar(g_df.index, g_df['Order ID'], color=colors, label='ì£¼ë¬¸ìˆ˜')
plt.plot(g_df.index, g_df['Customer ID'], color='k',
         linestyle='--', marker='o', label='ê³ ê°ìˆ˜')
plt.legend(ncols=1)
plt.show()
```

![graph1](/assets/images/US_E_Commerce/bar_line_graph.png){: .align-center width="80%"}
<center><small>ì›”ë³„(xì¶•) ì£¼ë¬¸ê±´ìˆ˜(bar) ë° ê³ ê°ìˆ˜(line)</small></center>

<br>

ìœ„ ê·¸ë˜í”„ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´, í•œ ê³ ê°ì´ í•´ë‹¹ ì›”ì— ë‘ë²ˆ ì´ìƒ êµ¬ë§¤í•˜ëŠ” ê²½ìš°ëŠ” ì˜ ì—†ë‹¤. ë¼ì¸ê·¸ë˜í”„ì™€ ë°” ê·¸ë˜í”„ì˜ ìœ„ì¹˜ê°€ ê±°ì˜ ë™ì¼í•˜ë‹¤ëŠ” ê²ƒì€ í•œ ê³ ê°ì´ íŠ¹ì • ì›”ì— ë¬¼í’ˆì„ êµ¬ë§¤í•  ë•Œ, ê·¸ ì›”ì— í•œë²ˆ ë” êµ¬ë§¤í•˜ëŠ” ê²½ìš°ëŠ” ì˜ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ëœ»ì´ë‹¤. <u>í•´ë‹¹ ê·¸ë˜í”„ë¥¼ ë³´ë‹ˆ RFM ë¶„ì„ì„ í•œë‹¤ë©´ Rë¥¼ 'ìµœê·¼ í•œë‹¬ ë‚´ì— êµ¬ë§¤í–ˆëŠ”ê°€?'ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ì„í•´ë´ì•¼ê² ë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆë‹¤.</u>

## 7-2. ìš”ì¼ë³„ ì£¼ë¬¸ê±´ìˆ˜ì™€ êµ¬ë§¤ì ìˆ˜
```python
# ìš”ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”í•˜ê³  ìš”ì¼ë³„ ì£¼ë¬¸ê±´ìˆ˜, êµ¬ë§¤ì ìˆ˜ë¥¼ êµ¬í•œë‹¤.
g_df = df.groupby('order_dow').agg({"Customer ID": "nunique", "Order ID": "nunique"})
g_df.index = [w for w in 'ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼']

# ì£¼ë¬¸ê±´ìˆ˜ëŠ” bar, êµ¬ë§¤ì ìˆ˜ëŠ” lineìœ¼ë¡œ ê·¸ë˜í”„ë¥¼ ê·¸ë¦°ë‹¤.
fig, ax = plt.subplots(figsize=(8, 4))
colors = sns.color_palette('Blues', 12)

plt.bar(g_df.index, g_df['Order ID'], color=colors, label='ì£¼ë¬¸ìˆ˜')
plt.plot(g_df.index, g_df['Customer ID'], color='k',
         linestyle='--', marker='o', label='ê³ ê°ìˆ˜')
plt.legend(ncols=1)
plt.show()
```

![graph2](/assets/images/US_E_Commerce/bar_line_graph2.png){: .align-center width="80%"}
<center><small>ìš”ì¼ë³„(xì¶•) ì£¼ë¬¸ê±´ìˆ˜(bar) ë° ê³ ê°ìˆ˜(line)</small></center>

<br>

ì£¼ë¡œ ì‚¬ë¬´ì‹¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¬¼í’ˆì„ íŒë§¤í•˜ë‹¤ ë³´ë‹ˆ í‰ì¼ì— ì£¼ë¬¸ì´ ë§ì´ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. 

<br>

# 8. íŒë§¤ì•¡ê³¼ ìˆœì´ìµ
ì›”ë³„, ìš”ì¼ë³„ ì´ íŒë§¤ì•¡ê³¼ ìˆœì´ìµì— ëŒ€í•œ ê·¸ë˜í”„ë¥¼ ê·¸ë ¤ë³¸ë‹¤. ë‘ ë³€ìˆ˜ì— ëŒ€í•œ ê´€ê³„ë¥¼ ì‹œê°í™”ë¥¼ í†µí•´ ì˜ˆì¸¡í•´ ë³¸ë‹¤.

## 8-1. ì›”ë³„ íŒë§¤ì•¡ê³¼ ìˆœì´ìµ
```python
# ì›”ë³„ ì´ íŒë§¤ì•¡, íŒë§¤í•œ ì´ ë¬¼í’ˆ ìˆ˜ëŸ‰, ìˆœì´ìµ 
g_df = df.groupby(by='order_month').agg({'Sales': 'sum', 'Quantity': 'sum', 'Profit': 'sum'})
g_df.reset_index(inplace=True)
```

![graph2-1](/assets/images/US_E_Commerce/category_groupby5.png){: .align-center width="45%"}

<br>

```python
fig = plt.figure(figsize=(8,4))
ax1 = fig.add_subplot() 

# ì²« ë²ˆì§¸: ë°” ì°¨íŠ¸(ì›”ë³„ ì´ íŒë§¤ì•¡)
colors = sns.color_palette('Blues', 12)
ax1.set_xticks(g_df.index)
ax1.bar(g_df.index, g_df['Sales'], color=colors, label='íŒë§¤ì•¡')
ax1.set_xlabel('ì›”')
ax1.set_ylabel('íŒë§¤ì•¡')
ax1.legend(loc='upper right', frameon=False)

# ë‘ ë²ˆì§¸: ë¼ì¸ ì°¨íŠ¸(ì›”ë³„ ì´ ìˆœì´ìµ)
color = 'k'
ax2 = ax1.twinx()
ax2.plot(g_df.index, g_df['Profit'], color=color, linestyle='--', marker='o', label='ìˆœì´ìµ')
ax2.set_ylabel('ìˆœì´ìµ', color='k')
ax2.legend(loc='upper right', bbox_to_anchor=(1.0, 0.9), frameon=False)
plt.show()
```

![graph2-2](/assets/images/US_E_Commerce/bar_line_graph3.png){: .align-center width="85%"}
<center><small>ì›”ë³„(xì¶•) ì´ íŒë§¤ì•¡(bar) ë° ìˆœì´ìµ(line)</small></center>

<br>

ì›”ë³„ë¡œ íŒë§¤ì•¡ê³¼ ìˆœì´ìµì„ ë³´ë©´, 3ì›”ì— ìˆœì´ìµì´ -ë¡œ ê¸‰ê²©í•˜ê²Œ ë¼ì¸ê·¸ë˜í”„ê°€ ë–¨ì–´ì§€ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. íŒë§¤ì•¡ê³¼ ìˆœì´ìµì˜ ê·¸ë˜í”„ ê²½í–¥ì´ ë¹„ìŠ·í•˜ê¸´ í•˜ì§€ë§Œ(íŒë§¤ì•¡ì´ ìƒìŠ¹í•˜ë©´ ìˆœì´ìµì´ ìƒìŠ¹, íŒë§¤ì•¡ì´ ê°ì†Œí•˜ë©´ ìˆœì´ìµì´ ê°ì†Œí•˜ëŠ” ê²½í–¥), íŠ¹íˆ 3ì›”ì— ê·¸ë˜í”„ì— ê¸‰ê²©í•œ ë³€í™”ê°€ ìˆë‹¤. 3ì›”ì— ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë˜ ê±´ì§€ ì¡°ê¸ˆ ë” ë¶„ì„ì„ ì§„í–‰í•´ë´ì•¼í•  ê²ƒê°™ë‹¤.

## 8-2. ìš”ì¼ë³„ íŒë§¤ì•¡ê³¼ ìˆœì´ìµ
```python
# ìš”ì¼ë³„ ì´ íŒë§¤ì•¡, íŒë§¤í•œ ì´ ë¬¼í’ˆ ìˆ˜ëŸ‰, ìˆœì´ìµ 
g_df = df.groupby(by='order_dow').agg({'Sales': 'sum', 'Quantity': 'sum', 'Profit': 'sum'})
g_df.index = [w for w in 'ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼']
g_df.reset_index(inplace=True)
g_df.columns = ['dow', 'Sales', 'Quantity', 'Profit']
```

![graph2-3](/assets/images/US_E_Commerce/category_groupby6.png){: .align-center width="45%"}

<br>

```python
fig = plt.figure(figsize=(8,4))
ax1 = fig.add_subplot() 

# ì²« ë²ˆì§¸: ë°” ì°¨íŠ¸(ì›”ë³„ ì´ íŒë§¤ì•¡)
colors = sns.color_palette('Blues', 12)
ax1.bar(g_df['dow'], g_df['Sales'], color=colors, label='íŒë§¤ì•¡')
ax1.set_xlabel('ìš”ì¼')
ax1.set_ylabel('íŒë§¤ì•¡')
ax1.legend(loc='upper right', frameon=False)

# ë‘ ë²ˆì§¸: ë¼ì¸ ì°¨íŠ¸(ì›”ë³„ ì´ ìˆœì´ìµ)
color = 'k'
ax2 = ax1.twinx()
ax2.plot(g_df['dow'], g_df['Profit'], color=color, linestyle='--', marker='o', label='ìˆœì´ìµ')
ax2.set_ylabel('ìˆœì´ìµ', color='k')
ax2.legend(loc='upper right', bbox_to_anchor=(1.0, 0.9), frameon=False)
plt.show()
```

![graph2-4](/assets/images/US_E_Commerce/bar_line_graph4.png){: .align-center width="85%"}
<center><small>ìš”ì¼ë³„(xì¶•) ì´ íŒë§¤ì•¡(bar) ë° ìˆœì´ìµ(line)</small></center>

<br>

í‰ì¼ ì¤‘ 'í™”ìš”ì¼'ì´ íŒë§¤ì•¡ì´ ê°€ì¥ ë†’ê³  ìˆœì´ìµë„ ê°€ì¥ ë†’ë‹¤. ìš”ì¼ë³„ íŒë§¤ì•¡/ìˆœì´ìµ ê·¸ë˜í”„ë¥¼ ë³´ë©´ ê²½í–¥ì´ ë¹„ìŠ·í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. íŒë§¤ì•¡ì´ ì¦ê°€í•˜ë©´ ìˆœì´ìµì´ ì¦ê°€í•˜ê³ , íŒë§¤ì•¡ì´ ê°ì†Œí•˜ë©´ ìˆœì´ìµë„ ê°ì†Œí•˜ëŠ” ê²½í–¥ì´ë‹¤. ì£¼ë§ ì¤‘ 'í† ìš”ì¼'ì— íŒë§¤ê°€ ì´ë£¨ì–´ì§€ëŠ” ê²½ìš°, ìˆœì´ìµì´ ê±°ì˜ 0ì— ê°€ê¹ë‹¤. ì™œ ì´ëŸ°ì§€ ë” í™•ì¸í•´ë´ì•¼í•  ê²ƒê°™ë‹¤. (í† ìš”ì¼ì— í• ì¸ìœ¨ì´ ë§ì´ ì ìš©ë˜ëŠ”ê°€? ê²°ì œì‹œìŠ¤í…œ ë¬¸ì œì¸ê°€? ê²°ì œ ì‹œìŠ¤í…œì— ëŒ€í•œ ë¶„ì„ì€ ìë£Œê°€ ì—†ì–´ì„œ ì–´ë µë‹¤.)

<br>

# 9. ë§¤ì¶œì•¡ ìƒìœ„ í’ˆëª©ê³¼ êµ­ê°€
## 9-1. íŒë§¤ëŸ‰ ìƒìœ„ í’ˆëª©
```python
# ë¬¼í’ˆì˜ ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ëœ ë¬¼í’ˆì˜ ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œ í’ˆëª©ì„ ì¶œë ¥í•œë‹¤.
df.groupby(['Category', 'Sub-Category'])[['Quantity']].agg('sum').nlargest(10, 'Quantity').style.format('{:,.0f}')
```

![graph3](/assets/images/US_E_Commerce/category_groupby1.png){: .align-center width="40%"}
<center><small>Top 10 ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ëœ ë¬¼í’ˆì˜ ì´ ìˆ˜ëŸ‰</small></center>

<br>

## 9-2. ë§¤ì¶œì•¡ ìƒìœ„ í’ˆëª©
```python
# ë¬¼í’ˆì˜ ì¹´í…Œê³ ë¦¬ë³„ ì´ ë§¤ì¶œì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œ í’ˆëª©ì„ ì¶œë ¥í•œë‹¤.
df.groupby(['Category', 'Sub-Category'])[['Sales']].agg('sum').nlargest(10, 'Sales').style.format('{:,.0f}')
```

![graph4](/assets/images/US_E_Commerce/category_groupby2.png){: .align-center width="40%"}
<center><small>Top 10 ì¹´í…Œê³ ë¦¬ë³„ ì´ ë§¤ì¶œì•¡</small></center>

<br>

ìœ„ ë‘ í‘œë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´, ê°€ì¥ ë§ì´ íŒë§¤ë˜ëŠ” í’ˆëª©ì€ ë°”ì¸ë”ë¦¬, ì¢…ì´ì™€ ê°™ì€ ì‚¬ë¬´ìš©í’ˆì´ë‹¤. Technology ì¤‘ Phoneë„ ë§ì´ íŒ”ë¦¬ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. Phoneì€ ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ëœ ë¬¼í’ˆì˜ ìˆ˜ì—ì„œ 5ìœ„ë¥¼ ì°¨ì§€í–ˆìœ¼ë‚˜ ë‹¨ê°€ê°€ ë†’ë‹¤ëŠ” ì ì—ì„œ ê°€ì¥ ë†’ì€ ë§¤ì¶œì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤. ìì‚¬ì—ì„  ì‚¬ë¬´ì‹¤ì—ì„œ í•„ìš”í•œ ì €ê°€ì˜ ì†Œë¹„ì¬(ì‚¬ë¬´ìš©í’ˆ)ê³¼ ê³ ê°€ì˜ ì œí’ˆ(ê°€êµ¬, ì „ìì œí’ˆ)ì„ íŒŒëŠ” ê³³ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.

## 9-3. ë§¤ì¶œì•¡ ìƒìœ„ êµ­ê°€
```python
# ì£¼ë³„ ì´ ë§¤ì¶œì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œì˜ stateë¥¼ ì¶œë ¥í•œë‹¤.
df.groupby('State')[['Sales']].agg('sum').nlargest(10, 'Sales').style.format('{:,.0f}')
```

![graph5](/assets/images/US_E_Commerce/category_groupby3.png){: .align-center width="35%"}
<center><small>Top 10 stateë³„ ì´ ë§¤ì¶œì•¡</small></center>

<br>

ë§¤ì¶œì•¡ì´ ê°€ì¥ ë†’ì€ ì£¼(state)ëŠ” ìº˜ë¦¬í¬ë‹ˆì•„ì´ë©° ê·¸ ë‹¤ìŒìœ¼ë¡œ ë†’ì€ ë§¤ì¶œì•¡ì„ ë³´ì´ëŠ” ê³³ì€ ë‰´ìš•ì´ë‹¤. 

<br>

# 10. ìˆœì´ìµ ìƒ,í•˜ìœ„ í’ˆëª©
```python
# ì¹´í…Œê³ ë¦¬ë³„ ì´ ìˆœì´ìµì„ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œì˜ ë¬¼í’ˆì„ ì¶œë ¥í•œë‹¤.
df.groupby(['Category', 'Sub-Category'])['Profit'].agg(['sum', 'mean']).nlargest(10, 'sum').style.format('{:,.0f}')

# ì¹´í…Œê³ ë¦¬ë³„ ì´ ìˆœì´ìµì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ìœ„ 10ê°œì˜ ë¬¼í’ˆì„ ì¶œë ¥í•œë‹¤.
df.groupby(['Category', 'Sub-Category'])['Profit'].agg(['sum', 'mean']).nsmallest(10, 'sum').style.format('{:,.0f}')
```

![graph5](/assets/images/US_E_Commerce/category_groupby4.png){: .align-center width="80%"}
<center><small>ì¹´í…Œê³ ë¦¬ë³„ ì´ ìˆœì´ìµ ìƒìœ„ 10ê°œ(ì™¼ìª½), ì¹´í…Œê³ ë¦¬ë³„ ì´ ìˆœì´ìµ í•˜ìœ„ 10ê°œ(ì˜¤ë¥¸ìª½)</small></center>

<br>

ë¬¼í’ˆë³„ ìˆœì´ìµì„ í™•ì¸í•´ë³´ë©´, Technology ì¤‘ ë³µì‚¬ê¸°ê°€ ê°€ì¥ ë†’ì€ ìˆœì´ìµì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤. ì°¸ê³ ë¡œ ë³µì‚¬ê¸°ëŠ” íŒë§¤ëŸ‰ì´ ê°€ì¥ ì‘ì€ ë¬¼í’ˆì´ë‹¤. ë°˜ëŒ€ë¡œ Furniture ì¤‘ í…Œì´ë¸” í•­ëª©ì˜ ë¬¼í’ˆì—ì„œ ì•½ -8000 ì •ë„ì˜ ì ìë¥¼ ë³´ê³ ìˆë‹¤. ë‹¤ìŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¶„ì„ì—ì„œ ìˆœì´ìµì´ -ê°’ì„ ë‚˜íƒ€ë‚´ê³  ìˆëŠ” í•­ëª©ë“¤ì— ëŒ€í•œ ê°œì„  ë°©í–¥ì„ ì•Œì•„ë´ì•¼ê² ë‹¤.

<br>

# Reference
- [Kaggle, 'United States E-Commerce records 2020' ë°ì´í„°ì…‹ ì¶œì²˜](https://www.kaggle.com/datasets/ammaraahmad/us-ecommerce-record-2020)
- [bytetool, ASCII/Binary of 0xa0](https://bytetool.web.app/en/ascii/code/0xa0/)
- [stackoverflow, 'utf-8' codec can't decode byte 0xa0 in position 4276: invalid start byte](https://stackoverflow.com/questions/48067514/utf-8-codec-cant-decode-byte-0xa0-in-position-4276-invalid-start-byte)

<br>

ğŸ‘©ğŸ»â€ğŸ’»ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤
<br>ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë”°ë”í•˜ê²Œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
{: .notice}