---
title:  "[DL] 합성곱 신경망(Convolutional Neural Network, CNN)"
layout: single

categories: "DL"
tags: ["CNN"]

toc: true
toc_sticky: true
toc_label : "목차"
toc_icon: "bars"

published: false
---

<small></small>

***

> **CNN 은 이미지 분류에 유용하게 사용되는 기술**이다. CNN은 1989년 LeCun이 발표한 논문 <small>"Backpropagation applied to handwritten zip code recognition"</small> 에서 처음 소개되었다. 그 당시에는 필기체 인식에 있어 의미있는 결과가 나왔지만 이를 범용화하는데엔 미흡한 부분이 있었다. LeCun은 추후에 LeNet이라는 네트워크를 1998년에 제안하게 되는데 이것이 최초의 CNN 이라고 할 수 있다.

<br>

# <span class="half_HL">1. 합성곱 신경망(CNN)이란?</span>
**합성곱 신경망(Convolutional Neural Network, CNN)** 은 이미지 인식, 이미지 분류를 수행하는 주요 신경망 기술이다.

<br>

<div style="text-align : center;">
<img src="https://miro.medium.com/max/1400/1*XbuW8WuRrAY5pC4t-9DZAQ.webp">
<br>
<small>Convolutional layers로 구성된 신경망 (출처 : Medium, Prabhu)</small>
</div>

<br>

- 위 그림은 입력 이미지를 처리하고 값을 기준으로 개체를 분류하는 CNN의 전체 흐름이다.
- 입력 이미지는 필터(Filters), 풀링(Pooling), 완전연결 계층(Fully connected layer, FC)이 있는 일련의 Convolution Layer를 통과하고 Softmax 함수를 적용하여 0과 1 사이의 확률 값으로 개체를 분류한다.


<br>

# <span class="half_HL">2. 합성곱 신경망(CNN)의 필요성</span>
합성곱 신경망은 이미지 처리에 탁월한 성능을 보이는 신경망이다. 특히 이미지 처리를 위해 사용되는 다층 퍼셉트론(MLP)의 한계를 보완할 수 있다. 


예를 들어, 손글씨를 분류해야하는 상황에서 아래 알파벳이 입력값으로 들어온다고 가정해본다.

<br>

<div style="text-align : center;">
<img src="https://ifh.cc/g/hTxzTG.png" width="450">
<br>
<small>손글씨, 알파벳 'd' 이미지 (GoodNotes로 제작)</small>
</div>

<br>

사람이 보기엔 위 그림이 모두 알파벳 'd'로 쉽게 판단이 가능하지만, 기계가 보기에는 각 픽셀마다 가진 값이 대부분 상이하므로 사실상 다른 값을 가진 입력이다. 특히 이미지가 위와 같이 방향이 다르거나 한쪽으로 치우쳐져 있는 등 변형이 존재한다면 다층 퍼셉트론(MLP)로 예측하는데 어려움이 있다.<br>
<u><small>cf. 다층 퍼셉트론의 입력층으로 1차원 벡터를 사용해야 함</small></u>

위 손글씨 이미지 중 네 번째 글씨를 1차원으로 변환해보았다. 아래 과정과 같이 2차원 이미지를 1차원으로 변환하게 되면 변환 전에 가지고 있던 **공간적인 구조(Spatial Structure) 정보가 유실**된다.<br>
- **공간적인 구조** : 가까운 픽셀 간의 관계
- **예** : 'd'는 동그란 부분과 막대기 부분이 붙어 있는데, 막대기의 왼쪽 아래부분에 연결되어있다. 
  - <u>이러한 구조가 1차원 배열로 변환되면 그러한 공간적 구조의 특징을 잃게 됨</u>

<br>

<div style="text-align : center;">
<img src="https://ifh.cc/g/0jhCLM.png" width="450">
<br>
<small>손글씨, 알파벳 'd' 이미지의 1차원 변환 과정 (GoodNotes, PowerPoint로 제작)</small>
</div>

<br>

위와 같은 '공간적 구조' 문제 때문에 이미지의 공간적인 구조 정보를 보전하면서 학습할 수 있는 방법이 필요해졌고, 이를 위해 **합성곱 신경망**이 사용된다.

<br>

# <span class="half_HL">3. 합성곱 신경망(CNN) 관련 용어</span>

## (1) 채널(Channel)

CNN 이미지 분류는 입력 이미지를 가져와 처리하고 특정 카테고리로 분류되는데, 컴퓨터는 입력 이미지를 **픽셀 배열**로 보고 이미지 해상도에 따라 달라진다. RGB 이미지에는 세 가지 색상 채널(Red, Green, Blue)이 있으며 ```(height, width, 3)```으로 표현된다.<br>
<u><small>cf. 이미지 해상도 hxwxd(h=높이, w=너비, d=치수)</small></u>

<br>

<div style="text-align : center;">
<img src="https://ifh.cc/g/pqVVxH.png" width="350">
<br>
<small>Grayscale image, RGB color image 표현법 (powerpoint로 제작)</small>
</div>

<br>

- 이미지는 ```(높이, 너비, 채널)```로 표현되는 3차원 텐서임
  - 높이 : 이미지의 세로 방향 픽셀 수
  - 너비 : 이미지의 가로 방향 픽셀 수
  - 채널 : 색 성분
    - 흑백 이미지 (채널 수 : 1)
    - 컬러 이미지 (채널 수 : 3)

### 예시로 이해하기
- 데이터 정보 : Tensorflow 튜토리얼 (MNIST)

```python
# 필요한 라이브러리 로드
import pandas as pd
import tensorflow as tf

# 텐서플로우 내장 데이터셋 : MNIST 로드
mnist = tf.keras.datasets.mnist

# 색상 표현 구간을 0 ~ 1사이로 변환(정규화)
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

# 특정 데이터 시각화
idx = 4
display(pd.DataFrame(x_train[idx]).style.background_gradient(cmap='gray'))
```

<div style="text-align : center;">
<img src="https://ifh.cc/g/GY7zTN.png" width="300">
<br>
<small>28*28 픽셀의 숫자 '9' 손글씨 데이터</small>
</div>

<br>

숫자 '9' 손글씨 데이터는 흑백 이미지이므로 (28, 28, 1)의 크기를 가지는 3차원 텐서이다. 정규화 전엔 하나의 픽셀 당 0 ~ 255 사이의 값(큰 값)으로 구성된다. 색을 나타내는 범위가 크면 연산 과정에서 속도(연산) 문제가 발생할 수 있기 때문에 0 ~ 1 사이의 값으로 변환했다.